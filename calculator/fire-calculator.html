<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FIRE Calculator - MoneyMath</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .tab-content {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
      display: none;
    }
    .tab-content.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .tab-btn.active {
      background-color: #2563eb;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

  <!-- Header -->
  <div id="include-header"></div>
  <!-- Navigation -->
  <div id="include-nav"></div>

  <!-- Main Calculator -->
  <main class="flex-1 flex flex-col lg:flex-row p-4 sm:p-6 gap-6">
    <!-- Input Panel -->
    <section class="bg-white p-4 sm:p-6 rounded shadow-md w-full lg:w-1/3 space-y-6">
      <h2 class="text-xl font-bold text-blue-600 mb-2">ğŸ”¥ FIRE Calculator</h2>
      <div>
        <label class="block font-semibold mb-1">ğŸ‚ Current Age</label>
        <input type="range" id="currentAge" min="20" max="60" value="30" class="w-full">
        <div class="text-sm text-right">Age: <span id="valCurrentAge">30</span></div>
      </div>
      <div>
        <label class="block font-semibold mb-1">ğŸ Retirement Age</label>
        <input type="range" id="retirementAge" min="30" max="60" value="50" class="w-full">
        <div class="text-sm text-right">Age: <span id="valRetirementAge">50</span></div>
      </div>
      <div>
        <label class="block font-semibold mb-1">ğŸŒ± Life Expectancy</label>
        <input type="range" id="lifeExpectancy" min="60" max="100" value="85" class="w-full">
        <div class="text-sm text-right">Age: <span id="valLifeExpectancy">85</span></div>
      </div>
      <div>
        <label class="block font-semibold mb-1">ğŸ’° Monthly Expenses Post Retirement (â‚¹)</label>
        <input id="monthlyExpense" type="range" min="10000" max="300000" step="1000" value="40000" class="w-full">
        <div class="text-sm text-right">â‚¹<span id="valMonthlyExpense">40000</span></div>
        <div class="text-xs italic text-gray-500 mt-1 text-right" id="expenseInWords"></div>
      </div>
      <div>
        <label class="block font-semibold mb-1">ğŸ“Š Pre-Retirement Return %</label>
        <input id="returnRate" type="range" min="4" max="20" step="0.5" value="12" class="w-full">
        <div class="text-sm text-right"><span id="valReturnRate">12</span>% annually</div>
      </div>
      <div>
        <label class="block font-semibold mb-1">ğŸ¦ Post-Retirement Return %</label>
        <input id="postReturnRate" type="range" min="1" max="15" step="0.5" value="5" class="w-full">
        <div class="text-sm text-right"><span id="valPostReturnRate">5</span>% annually</div>
      </div>
    </section>

    <!-- Output Panel -->
    <section class="w-full lg:w-2/3 space-y-6">
      <div class="bg-gradient-to-r from-sky-100 to-indigo-100 p-4 rounded shadow-md">
        <h3 class="text-lg font-semibold text-blue-700 mb-2">ğŸ“‹ FIRE Plan Summary</h3>
        <div id="fireResult" class="grid sm:grid-cols-3 gap-4 text-center font-medium"></div>
      </div>

      <div class="bg-white p-4 sm:p-6 rounded shadow-md">
        <h3 class="text-lg font-semibold text-blue-700 mb-4">ğŸ“Š Charts & Table</h3>
        <div class="flex gap-2 mb-4">
          <button onclick="showTab('corpus')" class="tab-btn active px-3 py-1 rounded">ğŸ“‰ Corpus Depletion</button>
          <button onclick="showTab('sip')" class="tab-btn px-3 py-1 rounded">ğŸ’¹ SIP Growth</button>
          <button onclick="showTab('table')" class="tab-btn px-3 py-1 rounded">ğŸ“‹ Table View</button>
        </div>

        <div id="tab-corpus" class="tab-content active"><canvas id="corpusChart" height="300"></canvas></div>
        <div id="tab-sip" class="tab-content"><canvas id="sipChart" height="300"></canvas></div>
        <div id="tab-table" class="tab-content overflow-auto">
          <table class="min-w-full text-sm border border-gray-200">
            <thead class="bg-gray-100 text-gray-700 font-semibold">
              <tr>
                <th class="border px-3 py-2 text-left">Year</th>
                <th class="border px-3 py-2 text-left">Corpus Remaining (â‚¹)</th>
                <th class="border px-3 py-2 text-left">SIP Corpus (â‚¹)</th>
              </tr>
            </thead>
            <tbody id="tableBody" class="text-gray-700 bg-white"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <div id="include-footer"></div>

  <script>
    async function loadPartial(id, file) {
      const res = await fetch(file);
      document.getElementById(id).innerHTML = await res.text();
    }

    function formatINR(num) {
      return parseFloat(num).toLocaleString('en-IN');
    }

    function numberToWords(num) {
      const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten',
        'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
      const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
      const inWords = (n) => {
        if (n < 20) return a[n];
        if (n < 100) return b[Math.floor(n / 10)] + (n % 10 ? ' ' + a[n % 10] : '');
        if (n < 1000) return a[Math.floor(n / 100)] + ' Hundred' + (n % 100 ? ' ' + inWords(n % 100) : '');
        if (n < 100000) return inWords(Math.floor(n / 1000)) + ' Thousand' + (n % 1000 ? ' ' + inWords(n % 1000) : '');
        if (n < 10000000) return inWords(Math.floor(n / 100000)) + ' Lakh' + (n % 100000 ? ' ' + inWords(n % 100000) : '');
        return inWords(Math.floor(n / 10000000)) + ' Crore' + (n % 10000000 ? ' ' + inWords(n % 10000000) : '');
      };
      return inWords(num);
    }

    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(`tab-${tabName}`).classList.add('active');
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    function updateFIRE() {
      const currentAge = +document.getElementById('currentAge').value;
      const retirementAge = +document.getElementById('retirementAge').value;
      const lifeExpectancy = +document.getElementById('lifeExpectancy').value;
      const monthlyExpense = +document.getElementById('monthlyExpense').value;
      const returnRate = +document.getElementById('returnRate').value;
      const postReturnRate = +document.getElementById('postReturnRate').value;
      const inflation = 0.07;

      document.getElementById('valCurrentAge').textContent = currentAge;
      document.getElementById('valRetirementAge').textContent = retirementAge;
      document.getElementById('valLifeExpectancy').textContent = lifeExpectancy;
      document.getElementById('valMonthlyExpense').textContent = monthlyExpense;
      document.getElementById('valReturnRate').textContent = returnRate;
      document.getElementById('valPostReturnRate').textContent = postReturnRate;
      document.getElementById('expenseInWords').textContent = numberToWords(monthlyExpense) + ' Rupees';

      const annualExpense = monthlyExpense * 12;
      const retirementYears = lifeExpectancy - retirementAge;
      const yearsToInvest = retirementAge - currentAge;
      const inflatedExpense = annualExpense * Math.pow(1 + inflation, yearsToInvest);
      const fireCorpus = inflatedExpense * ((1 - Math.pow(1 + postReturnRate / 100, -retirementYears)) / (postReturnRate / 100));
      const r = returnRate / 100 / 12;
      const n = yearsToInvest * 12;
      const sip = fireCorpus * r / ((Math.pow(1 + r, n) - 1) * (1 + r));

      document.getElementById('fireResult').innerHTML = `
        <div class="bg-blue-100 text-blue-700 rounded p-3 shadow">ğŸ”¥ FIRE Corpus Needed: â‚¹${formatINR(fireCorpus)}</div>
        <div class="bg-green-100 text-green-700 rounded p-3 shadow">ğŸ“† Years to Invest: ${yearsToInvest}</div>
        <div class="bg-purple-100 text-purple-700 rounded p-3 shadow">ğŸ§¾ Annual Expense at Retirement: â‚¹${formatINR(inflatedExpense)}</div>
        <div class="bg-yellow-100 text-yellow-700 rounded p-3 shadow">ğŸ“ˆ SIP Required/Month: â‚¹${formatINR(sip)}</div>
        <div class="bg-rose-100 text-rose-700 rounded p-3 shadow">ğŸ–ï¸ Retirement Duration: ${retirementYears} years</div>
      `;

      // Chart: Corpus
      let corpus = fireCorpus, corpusTrend = [], years = [];
      for (let i = 0; i < retirementYears; i++) {
        corpusTrend.push(Math.round(corpus));
        years.push(`Year ${i + 1}`);
        corpus = (corpus - inflatedExpense) * (1 + postReturnRate / 100);
      }
      if (window.corpusChart) window.corpusChart.destroy();
      window.corpusChart = new Chart(document.getElementById('corpusChart').getContext('2d'), {
        type: 'line',
        data: { labels: years, datasets: [{ label: 'Corpus Remaining (â‚¹)', data: corpusTrend, borderColor: '#9333ea', backgroundColor: 'rgba(147,51,234,0.2)', fill: true, tension: 0.3 }] },
        options: { responsive: true }
      });

      // Chart: SIP
      let sipCorpus = 0, sipGrowth = [], sipYears = [];
      for (let i = 1; i <= n; i++) {
        sipCorpus = (sipCorpus + sip) * (1 + r);
        if (i % 12 === 0) {
          sipGrowth.push(Math.round(sipCorpus));
          sipYears.push(`Year ${i / 12}`);
        }
      }
      if (window.sipChart) window.sipChart.destroy();
      window.sipChart = new Chart(document.getElementById('sipChart').getContext('2d'), {
        type: 'line',
        data: { labels: sipYears, datasets: [{ label: 'SIP Corpus (â‚¹)', data: sipGrowth, borderColor: '#16a34a', backgroundColor: 'rgba(22,163,74,0.2)', fill: true, tension: 0.3 }] },
        options: { responsive: true }
      });

      // Table View
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      for (let i = 0; i < Math.max(sipYears.length, years.length); i++) {
        tbody.innerHTML += `
          <tr>
            <td class="border px-3 py-1">${i + 1}</td>
            <td class="border px-3 py-1">${corpusTrend[i] ? 'â‚¹' + formatINR(corpusTrend[i]) : '-'}</td>
            <td class="border px-3 py-1">${sipGrowth[i] ? 'â‚¹' + formatINR(sipGrowth[i]) : '-'}</td>
          </tr>`;
      }
    }

    ['currentAge', 'retirementAge', 'lifeExpectancy', 'monthlyExpense', 'returnRate', 'postReturnRate']
      .forEach(id => document.getElementById(id).addEventListener('input', updateFIRE));

    window.addEventListener('DOMContentLoaded', () => {
      loadPartial('include-header', '/components/header.html');
      loadPartial('include-nav', '/components/nav.html');
      loadPartial('include-footer', '/components/footer.html');
      updateFIRE();
    });
  </script>
</body>
</html>
