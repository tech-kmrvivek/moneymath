<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Goal SIP Calculator | RupeesWise</title>
  <meta name="description" content="Calculate the monthly SIP needed to reach your financial goals. Factor in an initial lumpsum investment to get a precise plan.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/jpeg" href="/assets/images/fevicon.JPG"> <!-- Favicon added here -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-montserrat { font-family: 'Montserrat', sans-serif; }
    /* Custom styles for range sliders */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: #d1fae5; /* emerald-100 */
      border-radius: 5px;
      outline: none;
      opacity: 0.7;
      transition: opacity .2s;
    }
    input[type="range"]:hover {
      opacity: 1;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #10b981; /* emerald-500 */
      cursor: pointer;
      border-radius: 50%;
      border: 2px solid white;
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #10b981; /* emerald-500 */
      cursor: pointer;
      border-radius: 50%;
      border: 2px solid white;
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col">

  <!-- Placeholder for the Navigation Bar -->
  <div id="include-nav"></div>

  <!-- Main Content -->
  <main class="flex-1 w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <!-- Left Side: Calculator Inputs -->
      <section class="w-full lg:w-1/3 bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg space-y-6">
        <h2 class="text-2xl font-bold text-emerald-700 dark:text-emerald-400 font-montserrat">Goal SIP Calculator</h2>
        
        <div>
          <label for="targetAmountInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Target Amount</label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 text-sm">₹</span>
            <input id="targetAmountInput" type="number" value="10000000" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          </div>
          <input id="targetAmountSlider" type="range" min="100000" max="100000000" step="100000" value="10000000" class="w-full mt-2">
          <div id="targetAmountWords" class="text-right text-xs italic text-gray-500 dark:text-gray-400 mt-1"></div>
        </div>

        <div>
          <label for="initialInvestmentInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Ready to Invest (Lumpsum)</label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 text-sm">₹</span>
            <input id="initialInvestmentInput" type="number" value="500000" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          </div>
          <input id="initialInvestmentSlider" type="range" min="0" max="5000000" step="10000" value="500000" class="w-full mt-2">
          <div id="initialInvestmentWords" class="text-right text-xs italic text-gray-500 dark:text-gray-400 mt-1"></div>
        </div>

        <div>
          <label for="yearsInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Investment Tenure (Years)</label>
          <input id="yearsInput" type="number" value="15" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="yearsSlider" type="range" min="1" max="40" step="1" value="15" class="w-full mt-2">
        </div>

        <div>
          <label for="rateInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Assumed Rate of Return (%)</label>
          <input id="rateInput" type="number" value="12" step="0.5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="rateSlider" type="range" min="1" max="30" step="0.5" value="12" class="w-full mt-2">
        </div>
      </section>

      <!-- Right Side: Results & Table -->
      <section class="w-full lg:w-2/3 space-y-8">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Your Goal Plan</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
            <div class="bg-emerald-50 dark:bg-emerald-900/50 p-4 rounded-lg">
              <p class="text-sm text-emerald-600 dark:text-emerald-300 font-medium">Lumpsum Future Value</p>
              <p id="lumpsumFutureValue" class="text-2xl font-bold text-emerald-800 dark:text-emerald-200">₹0</p>
            </div>
            <div class="bg-red-50 dark:bg-red-900/50 p-4 rounded-lg">
              <p class="text-sm text-red-600 dark:text-red-300 font-medium">Amount Remaining</p>
              <p id="amountRemaining" class="text-2xl font-bold text-red-800 dark:text-red-200">₹0</p>
            </div>
            <div class="bg-yellow-50 dark:bg-yellow-900/50 p-4 rounded-lg">
              <p class="text-sm text-yellow-600 dark:text-yellow-300 font-medium">Required Monthly SIP</p>
              <p id="requiredSip" class="text-2xl font-bold text-yellow-800 dark:text-yellow-200">₹0</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Yearly Projection Table</h3>
            <div id="projectionTableContainer" class="max-h-96 overflow-y-auto">
                <!-- Table will be generated here -->
            </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Placeholder for the Footer -->
  <div id="include-footer"></div>

  <script>
    // --- DOM Elements ---
    const targetAmountInput = document.getElementById('targetAmountInput');
    const targetAmountSlider = document.getElementById('targetAmountSlider');
    const targetAmountWords = document.getElementById('targetAmountWords');
    const initialInvestmentInput = document.getElementById('initialInvestmentInput');
    const initialInvestmentSlider = document.getElementById('initialInvestmentSlider');
    const initialInvestmentWords = document.getElementById('initialInvestmentWords');
    const yearsInput = document.getElementById('yearsInput');
    const yearsSlider = document.getElementById('yearsSlider');
    const rateInput = document.getElementById('rateInput');
    const rateSlider = document.getElementById('rateSlider');
    const projectionTableContainer = document.getElementById('projectionTableContainer');

    // --- Output Elements ---
    const lumpsumFutureValueEl = document.getElementById('lumpsumFutureValue');
    const amountRemainingEl = document.getElementById('amountRemaining');
    const requiredSipEl = document.getElementById('requiredSip');

    // --- Utility Functions ---
    function formatINR(num) {
      if (num >= 10000000) return `₹${(num / 10000000).toFixed(2)} Cr`;
      if (num >= 100000) return `₹${(num / 100000).toFixed(2)} L`;
      return `₹${num.toLocaleString('en-IN')}`;
    }
    
    function numberToWords(num) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        const numStr = num.toString();
        if (num < 0) return 'minus ' + numberToWords(-num);
        if (num === 0) return 'zero';
        if (num < 20) return a[num];
        if (numStr.length === 2) return b[numStr[0]] + (numStr[1] === '0' ? '' : ' ' + a[numStr[1]]);
        if (numStr.length === 3) return a[numStr[0]] + ' hundred' + (num % 100 === 0 ? '' : ' and ' + numberToWords(num % 100));
        if (numStr.length === 4 || numStr.length === 5) return numberToWords(Math.floor(num / 1000)) + ' thousand' + (num % 1000 !== 0 ? ' ' + numberToWords(num % 1000) : '');
        if (numStr.length === 6 || numStr.length === 7) return numberToWords(Math.floor(num / 100000)) + ' lakh' + (num % 100000 !== 0 ? ' ' + numberToWords(num % 100000) : '');
        if (numStr.length > 7) return numberToWords(Math.floor(num / 10000000)) + ' crore' + (num % 10000000 !== 0 ? ' ' + numberToWords(num % 10000000) : '');
        return '';
    }

    // --- Calculation Logic ---
    function calculateGoalSip() {
      const targetAmount = parseFloat(targetAmountInput.value) || 0;
      const initialInvestment = parseFloat(initialInvestmentInput.value) || 0;
      const years = parseInt(yearsInput.value) || 0;
      const rate = parseFloat(rateInput.value) / 100 || 0;

      // 1. Future value of the initial lumpsum investment
      const lumpsumFv = initialInvestment * Math.pow(1 + rate, years);

      // 2. Shortfall to be covered by SIP
      const shortfall = targetAmount - lumpsumFv;

      // 3. Required monthly SIP to cover the shortfall
      const monthlyRate = rate / 12;
      const n = years * 12;
      let requiredSip = 0;
      if (shortfall > 0 && n > 0 && monthlyRate > 0) {
        requiredSip = (shortfall * monthlyRate) / (Math.pow(1 + monthlyRate, n) - 1);
      }

      // --- Update UI ---
      lumpsumFutureValueEl.textContent = formatINR(lumpsumFv);
      amountRemainingEl.textContent = formatINR(shortfall > 0 ? shortfall : 0);
      requiredSipEl.textContent = formatINR(requiredSip);
      targetAmountWords.textContent = numberToWords(targetAmount).split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') + ' Rupees';
      initialInvestmentWords.textContent = numberToWords(initialInvestment).split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') + ' Rupees';
      
      renderProjectionTable(initialInvestment, requiredSip, years, rate);
    }

    // --- Table Rendering ---
    function renderProjectionTable(lumpsum, sip, years, rate) {
        const monthlyRate = rate / 12;
        let lumpsumBalance = lumpsum;
        let sipBalance = 0;
        const projection = [];

        for (let y = 1; y <= years; y++) {
            lumpsumBalance *= (1 + rate);
            for (let m = 1; m <= 12; m++) {
                sipBalance = (sipBalance + sip) * (1 + monthlyRate);
            }
            projection.push({
                year: y,
                totalValue: lumpsumBalance + sipBalance
            });
        }

        let tableHTML = `
            <table class="min-w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">Year</th>
                        <th scope="col" class="px-6 py-3">Year End Value</th>
                    </tr>
                </thead>
                <tbody>
        `;
        projection.forEach(item => {
            tableHTML += `
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">${item.year}</td>
                    <td class="px-6 py-4 font-semibold text-emerald-600 dark:text-emerald-400">${formatINR(item.totalValue)}</td>
                </tr>
            `;
        });
        tableHTML += `</tbody></table>`;
        projectionTableContainer.innerHTML = tableHTML;
    }

    // --- Event Listeners and Initializer ---
    async function loadPartial(id, file) {
      try {
        const response = await fetch(file);
        if (!response.ok) throw new Error(`Failed to load ${file}: ${response.status}`);
        const text = await response.text();
        const element = document.getElementById(id);
        if (element) {
          element.innerHTML = text;
          Array.from(element.querySelectorAll("script")).forEach(oldScript => {
            const newScript = document.createElement("script");
            Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
            newScript.appendChild(document.createTextNode(oldScript.innerHTML));
            oldScript.parentNode.replaceChild(newScript, oldScript);
          });
        }
      } catch (error) {
        console.error(`Error loading partial: ${error}`);
      }
    }
    
    function setupEventListeners() {
      const sync = (input, slider) => {
        slider.addEventListener('input', () => {
          input.value = slider.value;
          calculateGoalSip();
        });
        input.addEventListener('input', () => {
          slider.value = input.value;
          calculateGoalSip();
        });
      };

      sync(targetAmountInput, targetAmountSlider);
      sync(initialInvestmentInput, initialInvestmentSlider);
      sync(yearsInput, yearsSlider);
      sync(rateInput, rateSlider);
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      await Promise.all([
        loadPartial("include-nav", "../components/nav.html"),
        loadPartial("include-footer", "../components/footer.html")
      ]);
      setupEventListeners();
      calculateGoalSip(); // Initial calculation
    });
  </script>
</body>
</html>
