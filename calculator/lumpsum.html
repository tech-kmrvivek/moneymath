<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lumpsum Calculator | RupeesWise</title>
  <meta name="description" content="Calculate the future value of your lumpsum investment with our easy-to-use calculator. See projections with charts and plan for your financial goals.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-montserrat { font-family: 'Montserrat', sans-serif; }
    /* Custom styles for range sliders */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: #d1fae5; /* emerald-100 */
      border-radius: 5px;
      outline: none;
      opacity: 0.7;
      transition: opacity .2s;
    }
    input[type="range"]:hover {
      opacity: 1;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #10b981; /* emerald-500 */
      cursor: pointer;
      border-radius: 50%;
      border: 2px solid white;
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #10b981; /* emerald-500 */
      cursor: pointer;
      border-radius: 50%;
      border: 2px solid white;
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col">

  <!-- Placeholder for the Navigation Bar -->
  <div id="include-nav"></div>

  <!-- Main Content -->
  <main class="flex-1 w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <!-- Left Side: Calculator Inputs -->
      <section class="w-full lg:w-1/3 bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg space-y-6">
        <h2 class="text-2xl font-bold text-emerald-700 dark:text-emerald-400 font-montserrat">Lumpsum Calculator</h2>
        
        <div>
          <label for="lumpAmountInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Total Investment</label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 text-sm">₹</span>
            <input id="lumpAmountInput" type="number" value="100000" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          </div>
          <input id="lumpAmountSlider" type="range" min="10000" max="10000000" step="10000" value="100000" class="w-full mt-2">
          <div id="lumpAmountWords" class="text-right text-xs italic text-gray-500 dark:text-gray-400 mt-1"></div>
        </div>

        <div>
          <label for="lumpYearsInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Investment Duration (Years)</label>
          <input id="lumpYearsInput" type="number" value="15" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="lumpYearsSlider" type="range" min="1" max="40" step="1" value="15" class="w-full mt-2">
        </div>

        <div>
          <label for="lumpRateInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Expected Annual Return (%)</label>
          <input id="lumpRateInput" type="number" value="12" step="0.5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="lumpRateSlider" type="range" min="1" max="30" step="0.5" value="12" class="w-full mt-2">
        </div>
      </section>

      <!-- Right Side: Results & Charts -->
      <section class="w-full lg:w-2/3 space-y-8">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Your Investment Summary</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
            <div class="bg-blue-50 dark:bg-blue-900/50 p-4 rounded-lg">
              <p class="text-sm text-blue-600 dark:text-blue-300 font-medium">Invested Amount</p>
              <p id="investedAmount" class="text-2xl font-bold text-blue-800 dark:text-blue-200">₹0</p>
            </div>
            <div class="bg-yellow-50 dark:bg-yellow-900/50 p-4 rounded-lg">
              <p class="text-sm text-yellow-600 dark:text-yellow-300 font-medium">Wealth Gained</p>
              <p id="wealthGained" class="text-2xl font-bold text-yellow-800 dark:text-yellow-200">₹0</p>
            </div>
            <div class="bg-emerald-50 dark:bg-emerald-900/50 p-4 rounded-lg">
              <p class="text-sm text-emerald-600 dark:text-emerald-300 font-medium">Maturity Value</p>
              <p id="maturityValue" class="text-2xl font-bold text-emerald-800 dark:text-emerald-200">₹0</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Yearly Projection Table</h3>
            <div id="projectionTableContainer" class="max-h-96 overflow-y-auto">
                <!-- Table will be generated here -->
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2 text-center">Wealth Breakdown</h3>
            <div class="max-w-xs mx-auto">
                <canvas id="lumpPieChart"></canvas>
            </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Placeholder for the Footer -->
  <div id="include-footer"></div>

  <script>
    // --- Chart instance ---
    let lumpPieChart;

    // --- DOM Elements ---
    const lumpAmountInput = document.getElementById('lumpAmountInput');
    const lumpAmountSlider = document.getElementById('lumpAmountSlider');
    const lumpAmountWords = document.getElementById('lumpAmountWords');
    const lumpYearsInput = document.getElementById('lumpYearsInput');
    const lumpYearsSlider = document.getElementById('lumpYearsSlider');
    const lumpRateInput = document.getElementById('lumpRateInput');
    const lumpRateSlider = document.getElementById('lumpRateSlider');
    const projectionTableContainer = document.getElementById('projectionTableContainer');

    // --- Output Elements ---
    const investedAmountEl = document.getElementById('investedAmount');
    const wealthGainedEl = document.getElementById('wealthGained');
    const maturityValueEl = document.getElementById('maturityValue');

    // --- Utility Functions ---
    function formatINR(num) {
      if (num >= 10000000) return `₹${(num / 10000000).toFixed(2)} Cr`;
      if (num >= 100000) return `₹${(num / 100000).toFixed(2)} L`;
      return `₹${num.toLocaleString('en-IN')}`;
    }

    function numberToWords(num) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        const numStr = num.toString();
        if (num < 0) return 'minus ' + numberToWords(-num);
        if (num === 0) return 'zero';
        if (num < 20) return a[num];
        if (numStr.length === 2) return b[numStr[0]] + (numStr[1] === '0' ? '' : ' ' + a[numStr[1]]);
        if (numStr.length === 3) return a[numStr[0]] + ' hundred' + (num % 100 === 0 ? '' : ' and ' + numberToWords(num % 100));
        if (numStr.length === 4 || numStr.length === 5) return numberToWords(Math.floor(num / 1000)) + ' thousand' + (num % 1000 !== 0 ? ' ' + numberToWords(num % 1000) : '');
        if (numStr.length === 6 || numStr.length === 7) return numberToWords(Math.floor(num / 100000)) + ' lakh' + (num % 100000 !== 0 ? ' ' + numberToWords(num % 100000) : '');
        if (numStr.length > 7) return numberToWords(Math.floor(num / 10000000)) + ' crore' + (num % 10000000 !== 0 ? ' ' + numberToWords(num % 10000000) : '');
        return '';
    }

    // --- Calculation Logic (Verified and Correct) ---
    function calculateLumpsum() {
      const P = parseFloat(lumpAmountInput.value) || 0;
      const years = parseInt(lumpYearsInput.value) || 0;
      const rate = parseFloat(lumpRateInput.value) / 100 || 0;
      
      const projection = [];
      for (let y = 1; y <= years; y++) {
        const maturity = P * Math.pow(1 + rate, y);
        projection.push({
          year: y,
          interest: maturity - P,
          value: maturity
        });
      }
      
      const finalMaturity = P * Math.pow(1 + rate, years);
      const gain = finalMaturity - P;

      // --- Update UI ---
      investedAmountEl.textContent = formatINR(P);
      wealthGainedEl.textContent = formatINR(gain);
      maturityValueEl.textContent = formatINR(finalMaturity);
      lumpAmountWords.textContent = numberToWords(P).split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') + ' Rupees';
      
      renderProjectionTable(projection);
      renderPieChart(P, gain);
    }

    // --- Table Rendering ---
    function renderProjectionTable(projection) {
        let tableHTML = `
            <table class="min-w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">Year</th>
                        <th scope="col" class="px-6 py-3">Interest Gained</th>
                        <th scope="col" class="px-6 py-3">Year End Value</th>
                    </tr>
                </thead>
                <tbody>
        `;
        projection.forEach(item => {
            tableHTML += `
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">${item.year}</td>
                    <td class="px-6 py-4">${formatINR(item.interest)}</td>
                    <td class="px-6 py-4 font-semibold text-emerald-600 dark:text-emerald-400">${formatINR(item.value)}</td>
                </tr>
            `;
        });
        tableHTML += `</tbody></table>`;
        projectionTableContainer.innerHTML = tableHTML;
    }

    // --- Chart Rendering ---
    function renderPieChart(invested, gain) {
      const pieCtx = document.getElementById('lumpPieChart').getContext('2d');
      if (lumpPieChart) lumpPieChart.destroy();
      lumpPieChart = new Chart(pieCtx, {
        type: 'doughnut',
        data: {
          labels: ['Invested Amount', 'Wealth Gained'],
          datasets: [{ 
            data: [invested, gain > 0 ? gain : 0], 
            backgroundColor: ['#3b82f6', '#10b981'],
            borderColor: ['#ffffff', '#ffffff'],
            borderWidth: 2,
          }]
        },
        options: { 
          responsive: true, 
          plugins: { 
            legend: { 
              position: 'bottom',
              labels: { color: document.body.classList.contains('dark') ? '#fff' : '#333' }
            } 
          } 
        }
      });
    }

    // --- Event Listeners and Initializer ---
    async function loadPartial(id, file) {
      try {
        const response = await fetch(file);
        if (!response.ok) throw new Error(`Failed to load ${file}: ${response.status}`);
        const text = await response.text();
        const element = document.getElementById(id);
        if (element) {
          element.innerHTML = text;
          Array.from(element.querySelectorAll("script")).forEach(oldScript => {
            const newScript = document.createElement("script");
            Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
            newScript.appendChild(document.createTextNode(oldScript.innerHTML));
            oldScript.parentNode.replaceChild(newScript, oldScript);
          });
        }
      } catch (error) {
        console.error(`Error loading partial: ${error}`);
      }
    }

    function setupEventListeners() {
      lumpAmountSlider.addEventListener('input', () => {
        lumpAmountInput.value = lumpAmountSlider.value;
        calculateLumpsum();
      });
      lumpAmountInput.addEventListener('input', () => {
        lumpAmountSlider.value = lumpAmountInput.value;
        calculateLumpsum();
      });
      
      lumpYearsSlider.addEventListener('input', () => {
        lumpYearsInput.value = lumpYearsSlider.value;
        calculateLumpsum();
      });
      lumpYearsInput.addEventListener('input', () => {
        lumpYearsSlider.value = lumpYearsInput.value;
        calculateLumpsum();
      });

      lumpRateSlider.addEventListener('input', () => {
        lumpRateInput.value = lumpRateSlider.value;
        calculateLumpsum();
      });
      lumpRateInput.addEventListener('input', () => {
        lumpRateSlider.value = lumpRateInput.value;
        calculateLumpsum();
      });
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      await Promise.all([
        loadPartial("include-nav", "../components/nav.html"),
        loadPartial("include-footer", "../components/footer.html")
      ]);
      setupEventListeners();
      calculateLumpsum(); // Initial calculation
    });
  </script>
</body>
</html>
