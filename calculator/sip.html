<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SIP Calculator | RupeesWise</title>
  <meta name="description" content="Calculate the future value of your SIP investments with our easy-to-use calculator. See projections with charts and plan for your financial goals.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-montserrat { font-family: 'Montserrat', sans-serif; }
    /* Custom styles for range sliders */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: #d1fae5; /* emerald-100 */
      border-radius: 5px;
      outline: none;
      opacity: 0.7;
      transition: opacity .2s;
    }
    input[type="range"]:hover {
      opacity: 1;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #10b981; /* emerald-500 */
      cursor: pointer;
      border-radius: 50%;
      border: 2px solid white;
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #10b981; /* emerald-500 */
      cursor: pointer;
      border-radius: 50%;
      border: 2px solid white;
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col">

  <!-- Placeholder for the Navigation Bar -->
  <div id="include-nav"></div>

  <!-- Main Content -->
  <main class="flex-1 w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
    <div class="flex flex-col lg:flex-row gap-8">

      <!-- Left Side: Calculator Inputs -->
      <section class="w-full lg:w-1/3 bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg space-y-6">
        <h2 class="text-2xl font-bold text-emerald-700 dark:text-emerald-400 font-montserrat">SIP Calculator</h2>
        
        <div>
          <label for="sipAmountInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Monthly Investment</label>
          <div class="mt-1 flex rounded-md shadow-sm">
            <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-400 text-sm">₹</span>
            <input id="sipAmountInput" type="number" value="10000" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          </div>
          <input id="sipAmountSlider" type="range" min="500" max="200000" step="500" value="10000" class="w-full mt-2">
          <div id="sipAmountWords" class="text-right text-xs italic text-gray-500 dark:text-gray-400 mt-1"></div>
        </div>

        <div>
          <label for="sipYearsInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Investment Duration (Years)</label>
          <input id="sipYearsInput" type="number" value="15" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="sipYearsSlider" type="range" min="1" max="40" step="1" value="15" class="w-full mt-2">
        </div>

        <div>
          <label for="sipRateInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Expected Annual Return (%)</label>
          <input id="sipRateInput" type="number" value="12" step="0.5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="sipRateSlider" type="range" min="1" max="30" step="0.5" value="12" class="w-full mt-2">
        </div>

        <div class="relative flex items-start">
          <div class="flex items-center h-5">
            <input id="stepUpCheck" type="checkbox" class="h-4 w-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500">
          </div>
          <div class="ml-3 text-sm">
            <label for="stepUpCheck" class="font-medium text-gray-700 dark:text-gray-300">Enable Step-Up SIP</label>
            <p class="text-gray-500 dark:text-gray-400">Increase your SIP amount annually.</p>
          </div>
        </div>

        <div id="stepUpSection" class="hidden space-y-2">
          <label for="stepUpInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Annual Step-Up (%)</label>
          <input id="stepUpInput" type="number" min="0" max="30" value="10" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white">
          <input id="stepUpSlider" type="range" min="0" max="30" value="10" class="w-full mt-2">
        </div>
      </section>

      <!-- Right Side: Results & Charts -->
      <section class="w-full lg:w-2/3 space-y-8">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
          <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Your Investment Summary</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
            <div class="bg-blue-50 dark:bg-blue-900/50 p-4 rounded-lg">
              <p class="text-sm text-blue-600 dark:text-blue-300 font-medium">Invested Amount</p>
              <p id="investedAmount" class="text-2xl font-bold text-blue-800 dark:text-blue-200">₹0</p>
            </div>
            <div class="bg-yellow-50 dark:bg-yellow-900/50 p-4 rounded-lg">
              <p class="text-sm text-yellow-600 dark:text-yellow-300 font-medium">Wealth Gained</p>
              <p id="wealthGained" class="text-2xl font-bold text-yellow-800 dark:text-yellow-200">₹0</p>
            </div>
            <div class="bg-emerald-50 dark:bg-emerald-900/50 p-4 rounded-lg">
              <p class="text-sm text-emerald-600 dark:text-emerald-300 font-medium">Maturity Value</p>
              <p id="maturityValue" class="text-2xl font-bold text-emerald-800 dark:text-emerald-200">₹0</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Yearly Projection Table</h3>
            <div id="projectionTableContainer" class="max-h-96 overflow-y-auto">
                <!-- Table will be generated here -->
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-5 gap-8">
            <div class="xl:col-span-3 bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Yearly Projection Graph</h3>
              <canvas id="sipLineChart"></canvas>
            </div>
            <div class="xl:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg flex flex-col justify-center">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Wealth Breakdown</h3>
              <canvas id="sipPieChart"></canvas>
            </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Placeholder for the Footer -->
  <div id="include-footer"></div>

  <script>
    // --- Chart instances ---
    let sipLineChart, sipPieChart;

    // --- DOM Elements ---
    const sipAmountInput = document.getElementById('sipAmountInput');
    const sipAmountSlider = document.getElementById('sipAmountSlider');
    const sipAmountWords = document.getElementById('sipAmountWords');
    const sipYearsInput = document.getElementById('sipYearsInput');
    const sipYearsSlider = document.getElementById('sipYearsSlider');
    const sipRateInput = document.getElementById('sipRateInput');
    const sipRateSlider = document.getElementById('sipRateSlider');
    const stepUpCheck = document.getElementById('stepUpCheck');
    const stepUpSection = document.getElementById('stepUpSection');
    const stepUpInput = document.getElementById('stepUpInput');
    const stepUpSlider = document.getElementById('stepUpSlider');
    const projectionTableContainer = document.getElementById('projectionTableContainer');

    // --- Output Elements ---
    const investedAmountEl = document.getElementById('investedAmount');
    const wealthGainedEl = document.getElementById('wealthGained');
    const maturityValueEl = document.getElementById('maturityValue');

    // --- Utility Functions ---
    function formatINR(num) {
      if (num >= 10000000) {
        return `₹${(num / 10000000).toFixed(2)} Cr`;
      }
      if (num >= 100000) {
        return `₹${(num / 100000).toFixed(2)} L`;
      }
      return `₹${num.toLocaleString('en-IN')}`;
    }
    
    function numberToWords(num) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        const numStr = num.toString();
        if (num < 0) return 'minus ' + numberToWords(-num);
        if (num === 0) return 'zero';
        if (num < 20) return a[num];
        if (numStr.length === 2) return b[numStr[0]] + (numStr[1] === '0' ? '' : ' ' + a[numStr[1]]);
        if (numStr.length === 3) return a[numStr[0]] + ' hundred' + (num % 100 === 0 ? '' : ' and ' + numberToWords(num % 100));
        if (numStr.length === 4 || numStr.length === 5) return numberToWords(Math.floor(num / 1000)) + ' thousand' + (num % 1000 !== 0 ? ' ' + numberToWords(num % 1000) : '');
        if (numStr.length === 6 || numStr.length === 7) return numberToWords(Math.floor(num / 100000)) + ' lakh' + (num % 100000 !== 0 ? ' ' + numberToWords(num % 100000) : '');
        if (numStr.length > 7) return numberToWords(Math.floor(num / 10000000)) + ' crore' + (num % 10000000 !== 0 ? ' ' + numberToWords(num % 10000000) : '');
        return '';
    }

    // --- Calculation Logic (Verified and Correct) ---
    function calculateSIP() {
      const P = parseFloat(sipAmountInput.value) || 0;
      const years = parseInt(sipYearsInput.value) || 0;
      const rate = parseFloat(sipRateInput.value) || 0;
      const stepUpEnabled = stepUpCheck.checked;
      const stepUpPercent = parseFloat(stepUpInput.value) || 0;

      let totalInvested = 0, maturity = 0;
      const projection = [];
      
      if (stepUpEnabled) {
        const r = rate / 100 / 12;
        let currentP = P;
        for (let y = 1; y <= years; y++) {
          for (let m = 0; m < 12; m++) {
            maturity = (maturity + currentP) * (1 + r);
            totalInvested += currentP;
          }
           projection.push({ 
            year: y, 
            invested: totalInvested,
            interest: maturity - totalInvested,
            value: maturity 
          });
          currentP *= (1 + stepUpPercent / 100);
        }
      } else {
        const r = rate / 100 / 12;
        for (let y = 1; y <= years; y++) {
            const n = y * 12;
            if (r > 0) {
                maturity = P * ((Math.pow(1 + r, n) - 1) / r) * (1 + r);
            } else {
                maturity = P * n;
            }
            totalInvested = P * n;
            projection.push({ 
                year: y, 
                invested: totalInvested,
                interest: maturity - totalInvested,
                value: maturity 
            });
        }
      }
      
      const finalGain = maturity - totalInvested;

      // --- Update UI ---
      investedAmountEl.textContent = formatINR(totalInvested);
      wealthGainedEl.textContent = formatINR(finalGain);
      maturityValueEl.textContent = formatINR(maturity);
      sipAmountWords.textContent = numberToWords(P).split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ') + ' Rupees';
      
      renderProjectionTable(projection);
      renderCharts(totalInvested, finalGain, projection);
    }

    // --- Table Rendering ---
    function renderProjectionTable(projection) {
        let tableHTML = `
            <table class="min-w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">Year</th>
                        <th scope="col" class="px-6 py-3">Invested</th>
                        <th scope="col" class="px-6 py-3">Interest</th>
                        <th scope="col" class="px-6 py-3">Year End Value</th>
                    </tr>
                </thead>
                <tbody>
        `;
        projection.forEach(item => {
            tableHTML += `
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">${item.year}</td>
                    <td class="px-6 py-4">${formatINR(item.invested)}</td>
                    <td class="px-6 py-4">${formatINR(item.interest)}</td>
                    <td class="px-6 py-4 font-semibold text-emerald-600 dark:text-emerald-400">${formatINR(item.value)}</td>
                </tr>
            `;
        });
        tableHTML += `</tbody></table>`;
        projectionTableContainer.innerHTML = tableHTML;
    }


    // --- Chart Rendering ---
    function renderCharts(invested, gain, projection) {
      const pieCtx = document.getElementById('sipPieChart').getContext('2d');
      if (sipPieChart) sipPieChart.destroy();
      sipPieChart = new Chart(pieCtx, {
        type: 'doughnut',
        data: {
          labels: ['Invested Amount', 'Wealth Gained'],
          datasets: [{ 
            data: [invested, gain > 0 ? gain : 0], 
            backgroundColor: ['#3b82f6', '#10b981'],
            borderColor: ['#ffffff', '#ffffff'],
            borderWidth: 2,
          }]
        },
        options: { 
          responsive: true, 
          plugins: { 
            legend: { 
              position: 'bottom',
              labels: {
                  color: document.body.classList.contains('dark') ? '#fff' : '#333'
              }
            } 
          } 
        }
      });

      const lineCtx = document.getElementById('sipLineChart').getContext('2d');
      if (sipLineChart) sipLineChart.destroy();
      sipLineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels: projection.map(p => p.year),
          datasets: [{
            label: 'Investment Value',
            data: projection.map(p => p.value),
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#10b981',
            pointBorderColor: '#fff',
            pointHoverRadius: 7,
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#10b981'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: {
              ticks: { 
                callback: value => formatINR(value),
                color: document.body.classList.contains('dark') ? '#9ca3af' : '#6b7280'
              },
              grid: { color: document.body.classList.contains('dark') ? '#374151' : '#e5e7eb' }
            },
            x: {
              ticks: { color: document.body.classList.contains('dark') ? '#9ca3af' : '#6b7280' },
              grid: { display: false }
            }
          }
        }
      });
    }

    // --- Event Listeners and Initializer ---
    async function loadPartial(id, file) {
      try {
        const response = await fetch(file);
        if (!response.ok) throw new Error(`Failed to load ${file}: ${response.status}`);
        const text = await response.text();
        const element = document.getElementById(id);
        if (element) {
          element.innerHTML = text;
          Array.from(element.querySelectorAll("script")).forEach(oldScript => {
            const newScript = document.createElement("script");
            Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
            newScript.appendChild(document.createTextNode(oldScript.innerHTML));
            oldScript.parentNode.replaceChild(newScript, oldScript);
          });
        }
      } catch (error) {
        console.error(`Error loading partial: ${error}`);
      }
    }

    function setupEventListeners() {
      const inputs = [sipAmountInput, sipAmountSlider, sipYearsInput, sipYearsSlider, sipRateInput, sipRateSlider, stepUpCheck, stepUpInput, stepUpSlider];
      inputs.forEach(input => input.addEventListener('input', calculateSIP));
      
      // Sync sliders and number inputs
      sipAmountSlider.addEventListener('input', () => sipAmountInput.value = sipAmountSlider.value);
      sipAmountInput.addEventListener('input', () => sipAmountSlider.value = sipAmountInput.value);
      
      sipYearsSlider.addEventListener('input', () => sipYearsInput.value = sipYearsSlider.value);
      sipYearsInput.addEventListener('input', () => sipYearsSlider.value = sipYearsInput.value);

      sipRateSlider.addEventListener('input', () => sipRateInput.value = sipRateSlider.value);
      sipRateInput.addEventListener('input', () => sipRateSlider.value = sipRateInput.value);

      stepUpSlider.addEventListener('input', () => stepUpInput.value = stepUpSlider.value);
      stepUpInput.addEventListener('input', () => stepUpSlider.value = stepUpInput.value);

      stepUpCheck.addEventListener('change', () => {
        stepUpSection.classList.toggle('hidden', !stepUpCheck.checked);
      });
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      await Promise.all([
        loadPartial("include-nav", "../components/nav.html"),
        loadPartial("include-footer", "../components/footer.html")
      ]);
      setupEventListeners();
      calculateSIP(); // Initial calculation
    });
  </script>
</body>
</html>
